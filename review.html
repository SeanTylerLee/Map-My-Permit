<!DOCTYPE html>
<html lang="en">
<head>
  <!-- iOS app setup -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Review Permit</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <!-- Page Header -->
  <header>Review Permit</header>

  <!-- Main Content -->
  <main class="container">
    <!-- Full OCR Text Area -->
    <section>
      <h2>Permit Text</h2>
      <textarea id="permitText" placeholder="Permit OCR text..."></textarea>
    </section>

    <!-- Extracted Directions -->
    <section>
      <h3>Parsed Directions</h3>
      <pre id="routePreview">Parsing...</pre>
    </section>

    <!-- Continue to Navigation -->
    <button id="goToMap">Continue to Navigation</button>
  </main>

  <!-- Bottom iOS-style nav -->
  <nav class="bottom-nav">
    <button onclick="history.back()">🔙 Back</button>
    <button onclick="location.href='index.html'">🏠 Home</button>
    <button onclick="location.href='settings.html'">⚙️ Settings</button>
  </nav>

  <!-- Route Parsing Script -->
  <script>
    const permitTextEl = document.getElementById('permitText');
    const routePreview = document.getElementById('routePreview');

    // Load saved OCR text from index.html
    const rawText = localStorage.getItem('ocrText') || '';
    permitTextEl.value = rawText;

    // Extract likely routing directions from permit text
    function extractRouteSteps(text) {
      const lines = text.split('\n');
      const routeLines = lines.filter(line =>
        /\b(US|I|SR|HWY|Hwy|FM|WY|CR|BUS|ALT|Loop)[- ]?\d+/i.test(line) ||
        /\b(merge|continue|exit|ramp|follow|take|bear|turn|toward|onto)\b/i.test(line)
      );
      return routeLines.map(l => l.trim()).filter(Boolean);
    }

    const routeSteps = extractRouteSteps(rawText);
    routePreview.textContent = routeSteps.length
      ? routeSteps.join('\n')
      : 'No route directions found. You can edit the permit text above to improve detection.';

    // Save cleaned route for next step
    localStorage.setItem('parsedRoute', JSON.stringify(routeSteps));

    // Button to move forward
    document.getElementById('goToMap').onclick = () => {
      if (!routeSteps.length) {
        alert('No route found. Try editing the permit text or re-uploading.');
        return;
      }
      window.location.href = 'navigate.html';
    };
  </script>

</body>
</html>